<!doctype html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>AI 音乐推荐</title>
	<style>
		body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'PingFang SC', 'Microsoft Yahei', sans-serif; margin: 40px; color: #222; }
		h1 { font-size: 20px; }
		.container { max-width: 720px; margin: 0 auto; }
		.input-row { display: flex; gap: 8px; }
		input[type="text"] { flex: 1; padding: 12px 14px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
		button { padding: 12px 16px; background: #111827; color: #fff; border: none; border-radius: 8px; cursor: pointer; }
		button:disabled { background: #9ca3af; cursor: not-allowed; }
		.card { border: 1px solid #eee; border-radius: 10px; padding: 12px 14px; margin-top: 12px; }
		.meta { color: #6b7280; font-size: 12px; }
	</style>
</head>
<body>
	<div class="container">
		<h1>AI 音乐推荐</h1>
		<p>输入自然语言，如：“来点运动时适合的动感流行音乐”。</p>
		<div class="input-row">
			<input id="q" type="text" placeholder="你想听什么风格/场景的音乐？" />
			<button id="go">推荐</button>
		</div>
		<div id="status" class="meta" style="margin-top:8px;"></div>
		<div id="list"></div>
	</div>

	<script>
		const $ = (id) => document.getElementById(id);
		const apiBase = (location.port === '8000' || location.hostname === 'localhost') ? '' : '';

		$('go').addEventListener('click', async () => {
			const query = $('q').value.trim();
			if (!query) return;
			$('go').disabled = true;
			$('status').textContent = '生成中…';
			$('list').innerHTML = '';
			try {
				const resp = await fetch(`${apiBase}/api/recommend`, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ query, top_k: 5 })
				});
				if (!resp.ok) throw new Error(await resp.text());
				const data = await resp.json();
				$('status').textContent = `策略：${data.meta?.strategy || ''}`;
				data.recommendations.forEach((r) => {
					const div = document.createElement('div');
					div.className = 'card';
					div.innerHTML = `
						<div><strong>${r.title}</strong> ${r.artist ? ' - ' + r.artist : ''}</div>
						<div class="meta">${r.album || ''} ${r.genre ? ' · ' + r.genre : ''} · 置信度 ${r.score?.toFixed(2) ?? '—'} · 来源 ${r.source || ''}</div>
					`;
					$('list').appendChild(div);
				});
			} catch (e) {
				$('status').textContent = '出错了：' + (e?.message || e);
			} finally {
				$('go').disabled = false;
			}
		});
	</script>
</body>
</html>


